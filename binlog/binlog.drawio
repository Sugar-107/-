<mxfile host="app.diagrams.net" modified="2023-11-20T10:55:23.456Z" agent="Mozilla/5.0" etag="abcde12345" version="21.7.5" type="device">
  <diagram id="binlog-knowledge-diagram" name="Binlog知识图谱">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Binlog主标题 -->
        <mxCell id="title" value="MySQL Binlog知识图谱" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=24;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="414" y="20" width="300" height="40" as="geometry" />
        </mxCell>
        
        <!-- Binlog核心节点 -->
        <mxCell id="binlog-core" value="Binlog&lt;br&gt;(二进制日志)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=16;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="484" y="80" width="160" height="60" as="geometry" />
        </mxCell>
        
        <!-- 第一部分：Binlog记录内容 -->
        <mxCell id="content-title" value="Binlog记录内容" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="180" y="170" width="160" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="content-1" value="数据变更事件(DML)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="220" width="160" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="content-1-example" value="INSERT: 插入新记录&lt;br&gt;UPDATE: 修改已有记录&lt;br&gt;DELETE: 删除现有记录&lt;br&gt;示例: INSERT INTO users (id, name) VALUES (1, 'Alice')" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="270" width="200" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="content-2" value="表结构变更(DDL)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="370" width="160" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="content-2-example" value="CREATE: 创建表/索引&lt;br&gt;ALTER: 修改表结构&lt;br&gt;DROP: 删除表/索引&lt;br&gt;示例: ALTER TABLE users ADD COLUMN age INT" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="420" width="200" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="content-3" value="事务相关信息" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="100" y="520" width="160" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="content-3-example" value="BEGIN: 事务开始标记&lt;br&gt;COMMIT: 事务提交&lt;br&gt;ROLLBACK: 事务回滚&lt;br&gt;XID: 事务ID" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="80" y="570" width="200" height="80" as="geometry" />
        </mxCell>
        
        <mxCell id="content-4" value="执行时间戳" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="300" y="220" width="160" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="content-4-example" value="记录每个事件的执行时间&lt;br&gt;格式: Unix时间戳&lt;br&gt;用于复制过程中的时间点恢复" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="290" y="270" width="180" height="70" as="geometry" />
        </mxCell>
        
        <mxCell id="content-5" value="操作类型(INSERT/&lt;br&gt;UPDATE/DELETE)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="300" y="350" width="160" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="content-5-example" value="使用事件类型标识符表示不同操作&lt;br&gt;例如: WRITE_ROWS_EVENT (插入)&lt;br&gt;UPDATE_ROWS_EVENT (更新)&lt;br&gt;DELETE_ROWS_EVENT (删除)" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="290" y="400" width="180" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="content-6" value="服务器ID" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="300" y="500" width="160" height="40" as="geometry" />
        </mxCell>
        
        <mxCell id="content-6-example" value="唯一标识产生Binlog的服务器&lt;br&gt;避免主从复制环境中的循环复制&lt;br&gt;在my.cnf中通过server-id设置" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="290" y="550" width="180" height="70" as="geometry" />
        </mxCell>
        
        <!-- 第二部分：Binlog模式 -->
        <mxCell id="format-title" value="Binlog格式模式" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="484" y="170" width="160" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="format-1" value="STATEMENT" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="484" y="220" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="format-1-desc" value="记录SQL语句本身" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="484" y="290" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="format-1-example" value="优点: 体积小，记录简洁&lt;br&gt;缺点: 依赖执行环境，不适用于&lt;br&gt;包含NOW()、UUID()等函数的查询&lt;br&gt;&lt;br&gt;示例: INSERT INTO t1 VALUES (1,2);&lt;br&gt;相比ROW模式占用空间更小" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="464" y="310" width="200" height="110" as="geometry" />
        </mxCell>
        
        <mxCell id="format-2" value="ROW" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="484" y="430" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="format-2-desc" value="记录行数据变化" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="484" y="500" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="format-2-example" value="优点: 记录实际数据变更，精确安全&lt;br&gt;缺点: 体积大，特别是大表批量操作时&lt;br&gt;&lt;br&gt;示例: 记录&lt;br&gt;更新前: (id=1, name='Alice', age=25)&lt;br&gt;更新后: (id=1, name='Alice', age=26)&lt;br&gt;而不仅仅是SQL语句" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="464" y="520" width="200" height="130" as="geometry" />
        </mxCell>
        
        <mxCell id="format-3" value="MIXED" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="484" y="660" width="160" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="format-3-desc" value="混合模式" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="484" y="730" width="160" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="format-3-example" value="智能决策使用的格式:&lt;br&gt;- 安全SQL使用STATEMENT格式&lt;br&gt;- 不安全SQL（如使用UUID()、NOW()等）&lt;br&gt;  自动切换为ROW格式&lt;br&gt;&lt;br&gt;结合了两种模式的优点，平衡体积和安全性" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="464" y="750" width="200" height="130" as="geometry" />
        </mxCell>
        
        <!-- 第三部分：FlinkCDC监听 -->
        <mxCell id="flinkcdc-title" value="FlinkCDC监听Binlog原理" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="784" y="170" width="240" height="30" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-1" value="MySQL-CDC Connector" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="814" y="220" width="180" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-1-desc" value="1. 模拟MySQL从节点" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1004" y="235" width="140" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-1-example" value="Flink SQL示例:&lt;br&gt;CREATE TABLE mysql_binlog (&lt;br&gt;  id INT,&lt;br&gt;  name STRING,&lt;br&gt;  age INT,&lt;br&gt;  PRIMARY KEY(id) NOT ENFORCED&lt;br&gt;) WITH (&lt;br&gt;  'connector' = 'mysql-cdc',&lt;br&gt;  'hostname' = 'localhost',&lt;br&gt;  'port' = '3306',&lt;br&gt;  'username' = 'root',&lt;br&gt;  'password' = 'password',&lt;br&gt;  'database-name' = 'mydb',&lt;br&gt;  'table-name' = 'users'&lt;br&gt;)" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="804" y="280" width="200" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-2" value="Debezium引擎" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="814" y="470" width="180" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-2-desc" value="2. 解析Binlog事件" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1004" y="485" width="140" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-2-example" value="Debezium将二进制日志解析为:&lt;br&gt;- 操作类型: c(创建), u(更新), d(删除)&lt;br&gt;- 详细数据: 修改前和修改后的值&lt;br&gt;- 元数据: 事件时间戳、来源表等" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="804" y="530" width="200" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-3" value="MySQL主从复制协议" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="814" y="630" width="180" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-3-desc" value="3. 以从服务器身份注册" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1004" y="645" width="140" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-3-example" value="- 通过COM_BINLOG_DUMP命令请求binlog&lt;br&gt;- 持续接收主服务器推送的binlog事件&lt;br&gt;- 记住复制位置(binlog文件名和位置)以&lt;br&gt;  便断点续传" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="804" y="690" width="200" height="90" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-4" value="数据变更事件处理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=14;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="814" y="790" width="180" height="50" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-4-desc" value="4. 转换为Flink数据流" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1004" y="805" width="140" height="20" as="geometry" />
        </mxCell>
        
        <mxCell id="flinkcdc-4-example" value="变更数据流应用场景:&lt;br&gt;- 实时数据同步到Kafka/ES等系统&lt;br&gt;- 实时计算和流处理&lt;br&gt;- 增量ETL处理&lt;br&gt;- 缓存更新/失效" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="804" y="850" width="200" height="90" as="geometry" />
        </mxCell>
        
        <!-- 连接线 -->
        <!-- Binlog到记录内容标题的连接 -->
        <mxCell id="conn-binlog-content" value="" style="endArrow=classic;html=1;rounded=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=3;jumpStyle=arc;jumpSize=6;" edge="1" parent="1" source="binlog-core" target="content-title">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="380" as="sourcePoint" />
            <mxPoint x="650" y="330" as="targetPoint" />
            <Array as="points">
              <mxPoint x="260" y="110" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- Binlog到格式模式标题的连接 -->
        <mxCell id="conn-binlog-format" value="" style="endArrow=classic;html=1;rounded=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=3;jumpStyle=arc;jumpSize=6;" edge="1" parent="1" source="binlog-core" target="format-title">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="380" as="sourcePoint" />
            <mxPoint x="650" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Binlog到FlinkCDC标题的连接 -->
        <mxCell id="conn-binlog-flinkcdc" value="" style="endArrow=classic;html=1;rounded=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=3;jumpStyle=arc;jumpSize=6;" edge="1" parent="1" source="binlog-core" target="flinkcdc-title">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="380" as="sourcePoint" />
            <mxPoint x="650" y="330" as="targetPoint" />
            <Array as="points">
              <mxPoint x="904" y="110" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <!-- FlinkCDC组件之间的连接 -->
        <mxCell id="conn-flinkcdc-1-2" value="" style="endArrow=classic;html=1;rounded=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=3;jumpStyle=arc;jumpSize=6;" edge="1" parent="1" source="flinkcdc-1-example" target="flinkcdc-2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="380" as="sourcePoint" />
            <mxPoint x="650" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="conn-flinkcdc-2-3" value="" style="endArrow=classic;html=1;rounded=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=3;jumpStyle=arc;jumpSize=6;" edge="1" parent="1" source="flinkcdc-2-example" target="flinkcdc-3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="380" as="sourcePoint" />
            <mxPoint x="650" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="conn-flinkcdc-3-4" value="" style="endArrow=classic;html=1;rounded=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=3;jumpStyle=arc;jumpSize=6;" edge="1" parent="1" source="flinkcdc-3-example" target="flinkcdc-4">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="600" y="380" as="sourcePoint" />
            <mxPoint x="650" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- 底部说明 -->
        <mxCell id="footer-note" value="注：Binlog是MySQL重要的日志系统，用于数据复制、备份恢复和变更数据捕获(CDC)，默认格式为ROW" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="320" y="950" width="560" height="30" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
